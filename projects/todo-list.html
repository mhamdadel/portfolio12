<!DOCTYPE html>
<html>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    .drop-list {
      width: 30%;
      margin: 0 auto;
      padding: 10px;
      border: 1px solid black;
    }
    .todo-item {
      padding-top: 10px;
      padding-bottom: 10px;
      text-align: center;
      border: 1px solid;
      border-radius: 3px;
      margin: 5px auto;
      display: flex;
      justify-content: space-between;
    }
    .todo-item span {
      padding: 0 10px;
    }
    .finished-list > .todo-item > span:first-child {
      text-decoration: line-through;
    }
  </style>

  <body>
    <div>
      <input id="newTodo" type="text" placeholder="add todo" />
      <button id="addTodoBtn" onclick="addTodo()">add todo</button>
    </div>
    <div>
      <input
        id="search"
        type="search"
        onkeyup="search(this)"
        placeholder="search"
      />
    </div>
    <div
      id="todo-list"
      class="drop-list"
      ondragover="allowDrop(event)"
      ondrop="drop(event)"
    >
      <p
        class="todo-item"
        ondrop="drop(event)"
        ondragstart="dragStart(event)"
        draggable="true"
        ondragenter="dragEnter(this)"
        ondragleave="dragLeave(this)"
        id="d1"
      >
        <span>Item 1</span>
        <span>
          <span onclick="removeGrandParent(this)">X</span>
          <input type="checkbox" onclick="swap(this)" />
        </span>
      </p>
      <p
        class="todo-item"
        ondrop="drop(event)"
        ondragstart="dragStart(event)"
        draggable="true"
        ondragenter="dragEnter(this)"
        ondragleave="dragLeave(this)"
        id="d2"
      >
        <span>Item 2</span>
        <span>
          <span onclick="removeGrandParent(this)">X</span>
          <input type="checkbox" onclick="swap(this)" />
        </span>
      </p>
      <p
        class="todo-item"
        ondrop="drop(event)"
        ondragstart="dragStart(event)"
        draggable="true"
        ondragenter="dragEnter(this)"
        ondragleave="dragLeave(this)"
        id="d3"
      >
        <span>Item 3</span>
        <span>
          <span onclick="removeGrandParent(this)">X</span>
          <input type="checkbox" onclick="swap(this)" />
        </span>
      </p>
    </div>
    <div
      id="finished-list"
      class="drop-list finished-list"
      ondragover="allowDrop(event)"
      ondrop="drop(event)"
    ></div>

    <script>
      const todoList = document.getElementById("todo-list");
      const finishedList = document.getElementById("finished-list");
      let selectedTodoList = undefined;
      if ( localStorage.getItem("todo-items-count") === undefined ){
        localStorage.setItem("todo-items-count" , 1);
        localStorage.setItem("todo-items", []);
      }
      let countOfItems = localStorage.getItem("todo-items-count"); 
      
      
      function isDescendant(parent, child) {
        var node = child.parentNode;
        while (node != null) {
          if (node == parent) {
            return true;
          }
          node = node.parentNode;
        }
        return false;
      }
      function insertAfter(referenceNode, newNode) {
        referenceNode.parentNode.insertBefore(
          newNode,
          referenceNode.nextSibling
        );
      }

      function addTodo() {
        const todoText = document.getElementById("newTodo").value;
        if (todoText != "") {
          if (selectedTodoList === undefined) {
            const todos = document.querySelectorAll('[id^="todo-list"]');
            const newChiled = `
            <p
            class="todo-item"
            ondrop="drop(event)"
            ondragstart="dragStart(event)"
            draggable="true"
            ondragenter="dragEnter(this)"
            ondragleave="dragLeave(this)"
            id="d${countOfItems}"
          >
            <span>${todoText}</span>
            <span>
              <span onclick="removeGrandParent(this)">X</span>
              <input type="checkbox" onclick="swap(this)" />
            </span>
          </p>
            `;
            localStorage.setItem("todo-items-count", ++countOfItems);
            [...todos].forEach((el) => {
              el.innerHTML += newChiled;
              localStorage.getItem("todo-items").push(el.lastChild);
              const newArr = localStorage.getItem("todo-items");
              localStorage.setItem("todoitems", );
            });
          } else {
          }
        }else{
          alert("todo dosn't exist");
        }
      }

      function dragEnter(t) {
        t.style.background =
          "linear-gradient(to bottom,  #9c9e9f 0%,#9c9e9f 50%,#33ccff 50%,#33ccff 100%)";
      }

      function dragLeave(t) {
        t.style.background = null;
      }

      function insertBefore(referenceNode, newNode) {
        referenceNode.parentNode.insertBefore(newNode, referenceNode);
      }

      function dragStart(event) {
        event.dataTransfer.setData("Text", event.target.id);
      }

      function allowDrop(event) {
        event.preventDefault();
      }

      function drop(event) {
        event.preventDefault();
        const data = event.dataTransfer.getData("Text");
        if (
          event.target.id.startsWith("finished-list") ||
          event.target.id.startsWith("todo-list")
        ) {
          event.target.appendChild(document.getElementById(data));
          console.log();
          if (event.target.id.startsWith("finished-list")) {
            // change  checkbox status to true on goto finished list
            document.getElementById(
              data
            ).children[1].children[1].checked = true;
          } else if (event.target.id.startsWith("todo-list")) {
            // change  checkbox status to false on goto todo list list
            document.getElementById(
              data
            ).children[1].children[1].checked = false;
          }
        } else if (
          document
            .getElementById(event.target.id)
            .classList.contains("todo-item")
        ) {
          const items = document.querySelectorAll(".drop-list .todo-item");
          [...items].forEach(function (el) {
            const data = event.dataTransfer.getData("Text");
            if (
              event.clientY >= el.offsetTop &&
              event.clientY <= el.offsetTop + el.offsetHeight / 2
            ) {
              document.getElementById(data).style.background = null;
              event.target.style.background = null;
              insertBefore(event.target, document.getElementById(data));
            } else if (
              event.clientY >= el.offsetTop &&
              event.clientY <= el.offsetTop + el.offsetHeight
            ) {
              document.getElementById(data).style.background = null;
              event.target.style.background = null;
              insertAfter(event.target, document.getElementById(data));
            }
          });
        }
      }

      /* todo list */
      function removeGrandParent(t) {
        t.parentNode.parentNode.remove();
      }

      function swap(t) {
        let element = t.parentNode.parentNode;
        let parent = element.parentNode;
        if (t.checked && parent.id.startsWith("todo-list")) {
          finishedList.appendChild(element);
        } else if (!t.checked && parent.id.startsWith("finished-list")) {
          todoList.appendChild(element);
        }
      }

      function search(search) {
        const items = document.querySelectorAll(".drop-list .todo-item");
        search.addEventListener("keyup", function (e) {
          for (let i = 0; i < items.length; i++) {
            const textOfItem = items[i].querySelector("span");
            let tableRows = items[i].children[0];
            if (
              textOfItem.textContent
                .toLowerCase()
                .indexOf(search.value.toLowerCase()) > -1 &&
              search.value != " "
            ) {
              tableRows.parentNode.style.display = "flex";
            } else {
              tableRows.parentNode.style.display = "none";
            }
          }
        });
      }
    </script>
  </body>
</html>
